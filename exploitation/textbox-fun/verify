#!/opt/pwn.college/python
import sys
sys.path.append('/challenge')

def print_flag():
	try:
		with open("/flag", "r") as f:
			print(f.read())
	except FileNotFoundError:
		print("Error: Flag file not found.")

# Add your imports and other code below here
import http.server
import socketserver

HTML_PAGE = """\
<!DOCTYPE html>
<html lang=\"en\">
<head>
	<meta charset=\"UTF-8\">
	<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
	<title>Simple Webpage</title>
</head>
<body>
	<h1>Enter some text</h1>
	<form method=\"post\">
		<input type=\"text\" name=\"user_input\" placeholder=\"Type here...\">
		<button type=\"submit\">Submit</button>
	</form>
	<p id=\"output\"></p>
	<script>
		document.querySelector('form').onsubmit = async function(event) {
			event.preventDefault();
			let formData = new FormData(this);
			let response = await fetch('/', { method: 'POST', body: formData });
			let text = await response.text();
			# document.querySelector('#output').innerText = text;
		};
	</script>
</body>
</html>
"""

class SimpleHTTPRequestHandler(http.server.BaseHTTPRequestHandler):
	def do_GET(self):
		self.send_response(200)
		self.send_header("Content-type", "text/html")
		self.end_headers()
		self.wfile.write(HTML_PAGE.encode("utf-8"))
	
	def do_POST(self):
		content_length = int(self.headers['Content-Length'])
		post_data = self.rfile.read(content_length).decode("utf-8")
		user_input = post_data.split('=')[1] if '=' in post_data else ""
		self.send_response(200)
		self.send_header("Content-type", "text/plain")
		self.end_headers()
		self.wfile.write(user_input.encode("utf-8"))
		print(user_input)

PORT = 8000
with socketserver.TCPServer(("", PORT), SimpleHTTPRequestHandler) as httpd:
	print(f"Serving on port {PORT}")
	httpd.serve_forever()
